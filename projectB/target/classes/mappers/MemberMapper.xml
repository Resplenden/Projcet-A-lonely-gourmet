<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="edu.study.mapper.memberMapper">
	
	<select id="selectMember" parameterType="String" resultType="memberVo">
		SELECT 
			id
			,name
			,email
		FROM member					
		WHERE email = #{email}		
	</select>
	 
	<update id = "updatePw" parameterType="memberVo">
		UPDATE member
		SET pwd=#{pwd} 
		WHERE email= #{email}
	</update>
	 	 	 
	 <select id="idCheck" parameterType="String" resultType="int">
		SELECT COUNT(id) 
			FROM member 
			WHERE id= #{id}
	</select>
	
	<select id="nameCheck" parameterType="String" resultType="int">
		SELECT COUNT(name) 
			FROM member 
			WHERE name= #{name}
	</select>
	 
	<select id="emailCheck" parameterType="String" resultType="int">
		SELECT COUNT(email) 
			FROM member 
			WHERE email= #{email}
	</select>	
	
	<select id="nickCheck" parameterType="String" resultType="int">
		SELECT COUNT(nickname) 
			FROM member 
			WHERE nickname= #{nickname}
	</select> 
	
	<!-- 로그인  -->
	<select id="login" parameterType="memberVo" resultType="memberVo">
		SELECT midx 
			,id
			,pwd
			,name
			,nickname
			,stname
	 		,orgname
			,nickname
			,midx
		FROM member
		WHERE id = #{id}
		
	</select>
	
	<!-- 회원가입 -->
	<insert id="join" parameterType="memberVo">
		<![CDATA[
			INSERT INTO member (
				midx
				,id
				,pwd
				,name				
				,nickname
				,birth
				,gender					
				,phone
				,email
				
				) VALUES (
					midx_seq.nextval
					,#{id}
					,#{pwd}
					,#{name}
					,#{nickname}
					,#{birth}					
					,#{gender}
					,#{phone}
					,#{email}
					
				)
		]]>	 	
		<selectKey  resultType="int" keyProperty="midx" order="AFTER">
	 	SELECT MAX(midx)
	 		from member
	 	</selectKey>
	</insert>
	
	<!-- 아이디 찾기 -->
	<select id="find_id" parameterType="String" resultType="memberVo">
		SELECT id
			FROM member
			WHERE name = #{name}
			AND email = #{email}
	</select>
	
	<!-- 이미지 파일 MemberFileVo에 넣기 -->
	<insert id="fileInsert" parameterType="HashMap">
		INSERT INTO memberfile(
	 		mfidx, 
			midx,
			orgfilename,
			storedname
		)VALUES(
	  		mfidx_seq.nextval,
			#{midx},
			#{orgfilename},
			#{storedname}
		)
	</insert>
	
	<select id="file" parameterType="int" resultType="mfileVo">
	 	SELECT
	 		mfidx 
	 		, midx
	 		, orgfilename
	 		, storedname	 		
	 	FROM memberfile	 
	 	WHERE midx=#{midx}
	 </select> 
	 
</mapper>