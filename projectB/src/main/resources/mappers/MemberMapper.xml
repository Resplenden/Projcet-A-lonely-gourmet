<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="edu.study.mapper.memberMapper">

	<!-- 로그인  -->
	<select id="login" parameterType="memberVo" resultType="memberVo">
		SELECT midx 
			,id
			,name
			,nickname
			,stname
	 		,orgname			
		FROM member
		WHERE id = #{id}
		AND pwd=#{pwd}
	</select>
		
	<select id="loginCheck" resultType="int">
		SELECT count(id) as count
		 	FROM member
		 	WHERE id=#{id}
		 	AND pwd=#{pwd}
	</select>
	

	<!-- 아이디 찾기 -->
	<select id="find_id" parameterType="String" resultType="memberVo">
		SELECT id
			FROM member
			WHERE name = #{name}
			AND email = #{email}
	</select>
	
	<!-- 비밀번호 찾기,  -->
	<select id="selectMember" parameterType="String" resultType="memberVo">
		SELECT 
			id
			,name
			,email
		FROM member					
		WHERE email = #{email}		
	</select>
	 
	<update id = "updatePw" parameterType="memberVo">
		UPDATE member
		SET pwd=#{pwd} 
		WHERE email= #{email}
	</update>
	 	 	 
	 <select id="idCheck" parameterType="String" resultType="int">
		SELECT COUNT(id) 
			FROM member 
			WHERE id= #{id}
	</select>
	
	<select id="nameCheck" parameterType="String" resultType="int">
		SELECT COUNT(name) 
			FROM member 
			WHERE name= #{name}
	</select>
	 
	<select id="emailCheck" parameterType="String" resultType="int">
		SELECT COUNT(email) 
			FROM member 
			WHERE email= #{email}
	</select>	
	
	<select id="nickCheck" parameterType="String" resultType="int">
		SELECT COUNT(nickname) 
			FROM member 
			WHERE nickname= #{nickname}
	</select> 


	<!-- 회원가입 -->
	<insert id="join" parameterType="memberVo">
		<![CDATA[
			INSERT INTO member (
				id
				,pwd
				,name	
				,birth			
				,nickname
				,gender	
				,email				
				,phone
				,orgname
				,stname
				,lvl
				,wdate
				,delyn
				
				) VALUES (
					#{id}
					,#{pwd}
					,#{name}
					,#{birth}
					,#{nickname}		
					,#{gender}
					,#{email}
					,#{phone}
					,#{orgname}
					,#{stname}
					,#{lvl}
					,now()
					,'N'
				)
		]]>	 	
		<selectKey  resultType="int" keyProperty="midx" order="AFTER">
	 	SELECT MAX(midx)
	 		from member
	 	</selectKey>
	</insert>
	

	<!-- 이미지 파일 MemberFileVo에 넣기 -->
	<insert id="fileInsert" parameterType="HashMap">
		INSERT INTO memberfile(
			midx,
			orgfilename,
			storedname
		)VALUES(
			#{midx},
			#{orgfilename},
			#{storedname}
		)
	</insert>
	
	
	 
</mapper>