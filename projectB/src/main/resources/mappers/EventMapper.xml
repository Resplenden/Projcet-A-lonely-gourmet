<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="edu.study.mapper.eventMapper">

	<sql id="search">
		<if test="searchType == 'title'">
		and title like '%'||#{searchVal}||'%'
		</if>
		<if test="searchType == 'contents'">
		and contents like '%'||#{searchVal}||'%'
		</if>
	</sql>
	
	<!-- Select 글조회-->
	<select id="list" parameterType="searchVo" resultType="eventVo">
	SELECT * FROM(
		SELECT ROWNUM AS RN, A.* FROM (
			SELECT * FROM EVENT 
			WHERE 1=1
			<include refid="search"></include>
			ORDER BY EIDX DESC
			)A
		)WHERE RN BETWEEN #{start} AND #{end}
	</select>
	
	<select id="count" parameterType="searchVo" resultType="int">
		select count(*)
		  from event
		  where 1=1
	</select>
	
	<!-- view -->
	<select id="selectByEidx" parameterType="int"  resultType="eventVo">
		SELECT eidx
			,title
			,contents
			,rec
			,wdate
			,writer
		FROM event
		WHERE eidx = #{eidx}
	</select>
	
	<!-- 조회수 -->
 	<update id="updateREC" parameterType="int">
 		UPDATE event	
 			 SET rec = rec + 1
 			 WHERE eidx = #{eidx}
 	</update>
 	
 	<!-- 글쓰기 -->
 <!-- Insert 글쓰기 -->
	<insert id="write" parameterType="eventVo">
		INSERT INTO event (
			eidx
			,title
			,contents
			,rec
			,wdate
			,writer
		) VALUES (
			eidx_seq.nextval
			,#{title}
			,#{contents}
			,0
			,sysdate
			,#{writer}
		)
	</insert>
	
	<!-- Update 글수정 -->
 	<!--글수정-->
 	<update id="modify" parameterType="eventVo">
 	 UPDATE event
 	 	SET title = #{title}
 	 		,contents = #{contents}
 	 	WHERE eidx=#{eidx}
 	
 	</update>
 	
 	<!-- Delete 글삭제-->
	<delete id="delete" parameterType="int">
		DELETE 
			FROM event
			WHERE eidx = #{eidx}
	</delete>
 	
 	
 	

 	
 	

	
</mapper>
	